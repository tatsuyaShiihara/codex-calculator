# 電卓アプリ 仕様書（初版）

## 概要
- 目的: ブラウザで動作する標準的な電卓を提供する（四則演算、パーセント、符号反転、AC）。
- 対象: 日常の簡易計算を素早く行いたい一般ユーザー。
- 提供形態: 単一ページ（`index.html`）で動作、フレームワーク不使用。
- 成功指標: 直感的操作、誤操作防止、読みやすい表示、キーボード操作対応。

## スコープ
- 含む
  - 入力: 数字 `0-9`、小数点 `.`、演算子 `+ - * /`、機能 `=` `AC` `±` `%`。
  - 表示: 上段に式（前項と演算子）、下段に結果。表示は読みやすさを優先し丸め/指数表記を行う。
  - 評価: 逐次評価（演算子連続入力で都度計算）。
  - パーセント: 単独は `current/100`、二項演算中は `previous * (current/100)`（iOS 方式）。
  - キーボード操作対応。
- 含まない
  - 括弧を用いた式評価、関数電卓機能（√、x²、1/x 等）、履歴保存、メモリ機能（M+/MR/MC）。

## ユースケース
- 単発計算: `12 + 7 =` → `19`。
- 連続計算: `10 × 5 =` → `50`、続けて `+ 3 =` → `53`（逐次評価）。
- 小数計算: `1.2 + 3.45 =` → `4.65`（末尾 0 は省略）。
- パーセント（単独）: `50 %` → `0.5`。
- パーセント（二項中）: `200 + 10 %` → `220`。
- 符号反転: `12 ±` → `-12`、`-12 ±` → `12`（0 は変化なし）。
- 入力やり直し: `AC` で全消去して再入力。
- キーボード: 数字/`.`/`+ - * /`/`Enter(=)`/`Esc(AC)`/`%`/`_`(±)。

## 機能要件
- 入力
  - 許可キー: 数字 `0-9`、小数点 `.`、演算子 `+ - * /`、機能 `=` `AC` `±` `%`。
  - 小数点は 1 回のみ受け付ける。同一数入力中の先頭 `0` は必要に応じて置換。
  - 直前に `=` 済みで数字入力した場合は新規入力として開始。
  - 入力暴走対策として、入力文字列は最大およそ 32 文字まで（超過は無視）。
- 演算/評価
  - 評価方式: 逐次評価。演算子連続入力時は都度計算し、次の演算子に更新。
  - `=` 実行で結果確定。続く数字入力で新規計算を開始。
  - 符号反転: 現在値の符号を反転（0 は変化なし）。
  - パーセント: 単独は `current/100`、二項演算中は `previous * (current/100)`。
  - 0 除算はエラー扱い（表示は「エラー」）。
- 表示
  - 上段に式（例: `12 ＋`）を表示。`=` 実行時は式表示をクリア。
  - 下段の結果表示は読みやすさ優先で整形。
    - 非有限値（Infinity/NaN）は「エラー」。
    - `|n| ≥ 1e12` または `0 < |n| < 1e-9` は指数表記（目安 8 桁）。
    - 通常は有効桁を整え末尾 0 を削除（目安 12 桁に丸め）。表示は概ね 16 桁以内。
- キーボード操作
  - 数字: `0-9`、小数点: `.`、四則: `+ - * /`、実行: `Enter`/`=`、全消去: `Escape`、パーセント: `%`、符号反転: `_`。

